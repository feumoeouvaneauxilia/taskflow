<!--<c-header class="mb-4 d-print-none" position="sticky">-->
<ng-container>
  <c-container [fluid]="true" class="border-bottom px-4">
    <button
      [cSidebarToggle]="sidebarId()"
      cHeaderToggler
      class="btn"
      toggle="visible"
      style="margin-inline-start: -14px;"
      aria-label="Toggle sidebar navigation"
    >
      <svg cIcon name="cilMenu" size="lg"></svg>
    </button>
  
    <c-header-nav class="d-none d-md-flex ms-auto ">
      <ng-container *ngTemplateOutlet="notificationDropdown" />
    </c-header-nav>

    <c-header-nav class="ms-auto ms-md-0">
      <div class="nav-item py-1">
        <div class="vr h-100 mx-2 text-body text-opacity-75"></div>
      </div>
      <ng-container *ngTemplateOutlet="themeDropdown" />
      <div class="nav-item py-1">
        <div class="vr h-100 mx-2 text-body text-opacity-75"></div>
      </div>
    </c-header-nav>

    <c-header-nav class="mx-0">
      <ng-container *ngTemplateOutlet="userDropdown" />
    </c-header-nav>

  </c-container>
  <c-container [fluid]="true" class="px-4">
    <h1 class="h5 my-2">ðŸ”¥Better ManagementðŸ”¥</h1>
  </c-container>
</ng-container>
<!--</c-header>-->

<ng-template #userDropdown>
  <c-dropdown [popperOptions]="{ placement: 'bottom-start' }" variant="nav-item">
    <button [caret]="false" cDropdownToggle class="py-0 pe-0" aria-label="Open user menu">
      <c-avatar
        shape="rounded-1"
        size="md"
        status="success"
        textColor="primary"
        alt="User avatar"
      >
        {{ getUserInitials() }}
      </c-avatar>
    </button>
    <ul cDropdownMenu class="pt-0 w-auto">
      <li>
        <h6 cDropdownHeader class="bg-body-secondary text-body-secondary fw-semibold py-2 rounded-top">
          Account - {{ userName || 'User' }}
        </h6>
      </li>


      <li>
        
        <a cDropdownItem >
          <svg cIcon class="me-2" name="cilUser"></svg>
        Profile Settings
      </a>
      </li>
      
      <li>
        <hr cDropdownDivider />
      </li>
      
    </ul>
  </c-dropdown>
</ng-template>

<ng-template #themeDropdown>
  <c-dropdown alignment="end" variant="nav-item">
    <button [caret]="false" cDropdownToggle aria-label="Open theme picker">
      <svg cIcon [name]="icons()" size="lg"></svg>
    </button>
    <div cDropdownMenu>
      @for (mode of colorModes; track mode.name) {
        <button
          (click)="colorMode.set(mode.name)"
          [active]="colorMode()===mode.name"
          cDropdownItem
          class="d-flex align-items-center"
        >
          <svg cIcon class="me-2" [name]="mode.icon" size="lg"></svg>
          {{ mode.text }}
        </button>
      }
    </div>
  </c-dropdown>
</ng-template>

<ng-template #notificationDropdown>
  <c-dropdown [popperOptions]="{ placement: 'bottom-start' }" variant="nav-item">
    <button 
      [caret]="false" 
      cDropdownToggle 
      class="btn nav-link position-relative"
      [class.notification-pulse]="hasNewNotification"
      aria-label="Open notifications"
      (click)="loadNotifications(); hasNewNotification = false"
    >
      <svg cIcon class="my-1" name="cilBell" size="lg"></svg>
      @if (unreadCount$ | async; as count) {
        @if (count > 0) {
          <c-badge 
            class="position-absolute top-0 start-100 translate-middle rounded-pill notification-badge"
            color="danger"
            style="font-size: 0.6em; padding: 0.25em 0.4em;"
          >
            {{ count > 99 ? '99+' : count }}
          </c-badge>
        }
      }
    </button>
    <div cDropdownMenu class="py-0" style="width: 350px; max-height: 400px; overflow-y: auto;">
      <div class="bg-body-secondary text-body-secondary fw-semibold py-2 px-3 border-bottom d-flex justify-content-between align-items-center">
        <span>Notifications</span>
        <div class="d-flex gap-1">
          <button 
            class="btn btn-sm btn-outline-secondary"
            (click)="refreshNotifications()"
            title="Refresh notifications"
          >
            <svg cIcon name="cilReload" size="sm"></svg>
          </button>
          @if (unreadCount$ | async; as count) {
            @if (count > 0) {
              <button 
                class="btn btn-sm btn-outline-primary"
                (click)="markAllAsRead()"
                title="Mark all as read"
              >
                Mark all read
              </button>
            }
          }
        </div>
      </div>
      
      @if (notifications$ | async; as notifications) {
        @if (notifications.length === 0) {
          <div class="p-3 text-center text-muted">
            <svg cIcon name="cilBell" size="xl" class="mb-2"></svg>
            <p class="mb-0">No notifications yet</p>
          </div>
        } @else {
          @for (notification of notifications.slice(0, 10); track notification.id) {
            <div 
              class="dropdown-item-text p-3 border-bottom"
              [class.bg-light]="!notification.isRead"
              style="cursor: pointer;"
              (click)="markAsRead(notification)"
            >
              <div class="d-flex align-items-start">
                <div class="me-3">
                  <svg 
                    cIcon 
                    [name]="getNotificationIcon(notification.type)" 
                    size="lg"
                    [class]="'text-' + getNotificationColor(notification.type)"
                  ></svg>
                </div>
                <div class="flex-grow-1 min-width-0">
                  <h6 class="mb-1 fw-semibold text-truncate" [class.text-muted]="notification.isRead">
                    {{ notification.title }}
                  </h6>
                  <p class="mb-1 small text-muted text-truncate">
                    {{ notification.message }}
                  </p>
                  <small class="text-muted">
                    {{ formatNotificationTime(notification.createdAt) }}
                  </small>
                </div>
                @if (!notification.isRead) {
                  <div class="ms-2">
                    <span class="badge bg-primary rounded-circle" style="width: 8px; height: 8px; padding: 0;"></span>
                  </div>
                }
              </div>
            </div>
          }
          @if (notifications.length > 10) {
            <div class="p-2 text-center border-top">
              <small class="text-muted">
                Showing 10 of {{ notifications.length }} notifications
              </small>
            </div>
          }
        }
      }
    </div>
  </c-dropdown>
</ng-template>
