<c-col xs="12">
  <c-card class="mb-4">
    <c-card-header>
      <strong>User Management</strong>
    </c-card-header>
    <c-card-body>
      <!-- Loading Spinner -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner-wrapper">
          <c-spinner color="danger" variant="grow"></c-spinner>
          <p class="loading-text">Loading users...</p>
        </div>
      </div>

      <!-- Main Content -->
      <div *ngIf="!isLoading">
        <!-- Search and Items per page controls -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="d-flex align-items-center">
            <label class="me-2">Items per page:</label>
            <select 
              class="form-select form-select-sm" 
              style="width: auto;"
              [value]="itemsPerPage"
              (change)="onItemsPerPageChange($event)"
            >
              <option *ngFor="let option of itemsPerPageOptions" [value]="option">
                {{ option }}
              </option>
            </select>
          </div>
          <div class="search-container">
            <input 
              type="text" 
              class="form-control" 
              placeholder="Search users..." 
              [value]="searchTerm"
              (input)="onSearch($event)"
              style="width: 250px;"
            >
          </div>
        </div>

        <!-- Table -->
        <div class="table-responsive">
          <table cTable [hover]="true" [striped]="true" class="table">
            <thead>
              <tr>
                <th>
                  <div class="d-inline">
                    Username
                    <svg [cIcon]="icons.cilUser" size="sm" class="ms-1 text-danger"></svg>
                  </div>
                </th>
                <th>
                  <div class="d-inline">
                    Email
                    <svg [cIcon]="icons.cilEnvelopeOpen" size="sm" class="ms-1 text-danger"></svg>
                  </div>
                </th>
                <th>
                  <div class="d-inline">
                    Roles
                    <svg [cIcon]="icons.cilBadge" size="sm" class="ms-1 text-danger"></svg>
                  </div>
                </th>
                <th>
                  <div class="d-inline">
                    Status
                    <svg [cIcon]="icons.cilToggleOn" size="sm" class="ms-1 text-danger"></svg>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of paginatedUsers">
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>
                  <div class="d-flex flex-wrap gap-1">
                    <c-badge 
                      *ngFor="let role of user.roles" 
                      [color]="getRoleBadgeColor(role)"
                      class="role-badge"
                    >
                      {{ formatRoleName(role) }}
                    </c-badge>
                  </div>
                </td>
                <td>
                  <c-badge 
                    [color]="user.isActive ? 'success' : 'danger'"
                    (click)="toggleUserStatus(user.id!, user.isActive!)"
                    style="cursor: pointer;"
                  >
                    {{ user.isActive ? 'Active' : 'Inactive' }}
                  </c-badge>
                </td>
              </tr>
              <tr *ngIf="paginatedUsers.length === 0 && !isLoading">
                <td colspan="4" class="text-center">
                  {{ searchTerm ? 'No users found matching your search.' : 'No users found.' }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination and Info -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <div class="pagination-info">
            Showing {{ startItem }} to {{ endItem }} of {{ totalItems }} entries
            <span *ngIf="searchTerm" class="text-muted">(filtered)</span>
          </div>
          
          <nav *ngIf="totalPages > 1">
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button 
                  class="page-link" 
                  (click)="onPageChange(currentPage - 1)"
                  [disabled]="currentPage === 1"
                >
                  Previous
                </button>
              </li>
              
              <li 
                class="page-item" 
                *ngFor="let page of pages" 
                [class.active]="page === currentPage"
              >
                <button 
                  class="page-link" 
                  (click)="onPageChange(page)"
                >
                  {{ page }}
                </button>
              </li>
              
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <button 
                  class="page-link" 
                  (click)="onPageChange(currentPage + 1)"
                  [disabled]="currentPage === totalPages"
                >
                  Next
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </c-card-body>
  </c-card>
</c-col>